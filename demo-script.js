let debug=!1;debug||(console.log=function(){});let IPcountryCode="",formValidated=!0;function dynamicSort(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(o,n){return-1===t?n[e].localeCompare(o[e]):o[e].localeCompare(n[e])}}document.querySelectorAll('input[type="tel"]').forEach((e=>{e.addEventListener("input",(function(){e.value=e.value.replace(/[^0-9]/g,"")}))}));const emailElement=document.getElementById("email");function showEmailError(e){const t=document.getElementById("email-error");e?(t.style.display="block",t.innerText=e,formValidated=!1):(t.style.display="none",formValidated=!0)}async function validateWithCodeJudge(e){const t=new AbortController,o=new Promise(((e,o)=>setTimeout((()=>{t.abort(),o(new Error("CodeJudge API timeout"))}),5e3))),n=fetch(`https://work.codejudge.io/api/validate-email/?email=${encodeURIComponent(e)}&corp_email_only=True`,{method:"PUT",headers:{"Content-Type":"application/json"},signal:t.signal});let r;try{r=await Promise.race([n,o])}catch(e){throw e}if(!r.ok)throw new Error("CodeJudge API failed");const a=await r.json();if(!a.response&&a.email_valid&&!1===a.corporate_email_valid)showEmailError("Please enter a valid company or business email address.");else if(a.response&&a.email_valid){if(!(a.response&&a.email_valid&&a.corporate_email_valid))throw new Error("Unexpected response format");showEmailError("")}else showEmailError("Please enter a valid company or business email address.")}async function validateWithHubSpot(e){const t=await fetch("https://forms.hsforms.com/emailcheck/v1/json-ext?portalId=8552073&includeFreemailSuggestions=false",{method:"POST",body:e});if(!t.ok)throw new Error("HubSpot API failed");(await t.json()).emailFree?showEmailError("Please enter a valid company or business email address."):showEmailError("")}async function checkEmailValidity(e){try{await validateWithCodeJudge(e)}catch(t){console.warn("CodeJudge API failed, trying HubSpot fallback:",t);try{await validateWithHubSpot(e)}catch(e){console.error("Both APIs failed:",e),showEmailError("An error occurred. Please try again.")}}return formValidated}function setDefaultSelectOption(e,t){const o=document.getElementById(e);if(o){const e=new Option(t,"");e.setAttribute("selected","true"),e.setAttribute("disabled","true"),o.options[0]=e}}localStorage.getItem("resEmail")&&emailElement&&(emailElement.value=localStorage.getItem("resEmail")),emailElement.addEventListener("focusout",(e=>{checkEmailValidity(e.target.value)})),setDefaultSelectOption("number_of_remote_hires","Number of hires"),setDefaultSelectOption("how_can_we_help_you_new-input","How can we help you?"),setDefaultSelectOption("company_size","Company size");let countries=[],countryCodeSelect=document.getElementById("phone-code-dropdown"),countryInput=document.querySelector('input[name="country"]'),countryName=document.getElementById("countries_you_want_to_enroll");countryInput&&(countryInput.readOnly=!0);const setCountryCodeOptions=e=>{let t=new Option("Select Country Code",""),o=document.querySelector(".country-loading");countryCodeSelect.options[0]=t,t.setAttribute("selected","true"),t.setAttribute("disabled","true");for(let t=0;t<e.length;t++){let o=`${e[t].label} (${e[t].dial_code})`;countryCodeSelect.options[countryCodeSelect.options.length]=new Option(o,e[t].dial_code)}countryCodeSelect.value="+1",e&&o&&(o.style.display="none")},fetchCountryList=async()=>{try{const e=await fetch("https://storage.googleapis.com/skuad-public-assets/country-list.json"),t=await e.json();countries=t.countryList,countryCodeSelect&&setCountryCodeOptions(t.countryList);let o=t.countryList;o.sort(dynamicSort("label")),o.push({label:"Others",dial_code:"",value:"Others"}),countryName&&(countryName.innerHTML=o.map((e=>`<option value="${e.label}">${e.label}</option>`)).join(""),"function"==typeof countryName.loadOptions&&countryName.loadOptions())}catch(e){console.error("Error fetching country list:",e)}};fetchCountryList();const fetchIpInfo=async()=>{try{const e=await fetch("https://api.geoapify.com/v1/ipinfo?&apiKey=c23115da6cf642e59b96f32b9d512a4c"),t=await e.json();if(t?.country){const e="+"+t.country.phone_code,o=countries.find((t=>t.dial_code===e));o&&(countryInput.value=o.label,countryCodeSelect.value=o.dial_code),IPcountryCode=t.country.iso_code}}catch(e){console.error("Error fetching IP info:",e)}};fetchIpInfo(),countryCodeSelect.addEventListener("change",(function(){const e=countryCodeSelect.value,t=countries.find((t=>t.dial_code===e));t&&countryInput&&(countryInput.value=t.label)}));const _submitHubspotForm=(e,t,o,n,r)=>{const a=document.getElementById("request_demo_submit-btn");a.value="Please wait...",a.disabled=!0,delete e["phone-code"],delete e.ld_field,"Other"==$("#how_can_we_help_you_new-input").val()&&delete e.how_can_we_help_you_new;let i={submittedAt:(new Date).getTime(),fields:[],context:{hutk:getCookie("hubspotutk"),pageUri:window.location.href,pageName:document.title}},l=0;for(const t in e)e.hasOwnProperty(t)&&(i.fields[l]={objectTypeId:"0-1",name:t,value:e[t]},l++);let s=i.fields.findIndex((e=>"countries_you_want_to_enroll"==e.name));-1!==s&&(i.fields[s].value=$("#countries_you_want_to_enroll").val().toString()),fetch(`https://api.hsforms.com/submissions/v3/integration/submit/${o}/${n}`,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(i)}).then((e=>e.json())).then((o=>{a.value="Submit",o.inlineMessage?(localStorage.setItem("skuadSignupFormData",JSON.stringify({...e,countryCode:t})),"function"!=typeof klentyFormSubmit&&(window.location.href="/book-a-meeting")):"error"===o.status&&"BLOCKED_EMAIL"===o.errors[0].errorType||"error"===o.status&&"INVALID_EMAIL"===o.errors[0].errorType?(document.getElementById("email-error").style.display="block",document.getElementById("email-error").innerText="Please enter a valid company or business email address."):"error"===o.status&&"NUMBER_OUT_OF_RANGE"===o.errors[0].errorType&&(document.getElementById("phone-error").style.display="block",document.getElementById("phone-error").innerText="Please enter valid phone number")})).catch((e=>{a.value="Submit",a.disabled=!1}))},hubspotOnSubmit=e=>{e.preventDefault();const t=new FormData(e.target);let o=Object.fromEntries(t.entries());const n=IPcountryCode||countries.find((e=>e.dial_code===o["phone-code"]))?.value;o.phone=o["phone-code"]+o.phone,checkEmailValidity(o.email).then((()=>{formValidated&&(_submitHubspotForm(o,n,"8552073","2b4e05d0-d685-4929-b37c-f961d7db9de5"),"function"==typeof klentyFormSubmit&&klentyFormSubmit("request-demo-api-form"))})),document.getElementById("request-demo-api-form").style.display="block",document.getElementById("hubspot-form-success").style.display="none",document.getElementById("hubspot-form-error").style.display="none"};document.getElementById("request-demo-api-form").addEventListener("submit",hubspotOnSubmit),document.getElementById("request-demo-api-form").addEventListener("change",(e=>{document.getElementById(e.target.name+"-error")&&(document.getElementById(e.target.name+"-error").style.display="none"),"email"===e.target.name&&(formValidated=!0)}));
