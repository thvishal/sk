const scriptURL="https://script.google.com/macros/s/AKfycbxYDZo3tZjFkNM5O96Fjda4dGy9ynHXl4GnQiUMQqXbRdGIf_8MWzznmS1uwTlT_9GFFA/exec",roleInitailly=document.getElementById("roles-input"),coutryInitially=document.getElementById("country-input"),roleTwo=document.getElementById("roles-input-filter"),coutryTwo=document.getElementById("country-input-filter");roleInitailly.value="Loading...",coutryInitially.value="Loading...",roleInitailly.setAttribute("disabled",""),coutryInitially.setAttribute("disabled","");let allRoles=[];const createList=(e,t="",l="",r)=>{let a=document.getElementById(t),n=a.querySelector("ul"),i=n||document.createElement("ul");i.innerHTML="",e.forEach(e=>{let t=document.createElement("li");t.classList.add(l),t.innerText=e,t.addEventListener("click",e=>{if(e.target.parentNode.classList.remove("show"),"Item not found"===e.target.innerText){e.target.parentNode.classList.add("show");return}e.target.parentElement.previousElementSibling.value=e.target.innerText}),i.appendChild(t)}),i.classList.add("ul-list"),a.appendChild(i)};let countries=[],roles=[];const getData=()=>{fetch(scriptURL,{method:"GET","Access-Control-Allow-Origin":"*"}).then(e=>e.json()).then(e=>{countries=e.data.countries,roles=e.data.roles,createList(countries,"countries","country-list-item"),createList(roles,"roles","roles-list-item"),createList(roles,"roles-2","roles-list-item-2"),createList(countries,"countries-2","country-list-item-2")}).catch(e=>console.log(e)).finally(e=>{roleInitailly.value="",coutryInitially.value="",roleInitailly.removeAttribute("disabled"),coutryInitially.removeAttribute("disabled")})};getData();const graphResult=document.getElementById("graph-result"),loadingImg=document.getElementById("loading-img"),initiallyDummyGraph=document.getElementById("initially-dummy-graph"),dscAvgSal=document.getElementById("not-avg-sal");let minCtcMonth=[],maxCtcMonth=[],minCtcYear=[],maxCtcYear=[],medianValue=0;const durationChange=document.getElementById("duration");let duration="year";const yourRole=document.querySelectorAll(".your-role"),selectedCountry=document.querySelectorAll(".selected-country"),searchHandler=(e,t)=>{e.preventDefault();var l=document.querySelectorAll(".w-form-done"),r=document.querySelectorAll(".w-form-fail"),a=document.querySelectorAll("form");loadingImg.style.display="flex",a.forEach(function(e){e.classList.add("show")}),l.forEach(function(e){e.classList.add("hide")}),r.forEach(function(e){e.classList.add("hide")});let n=coutryInitially.value,i=roleInitailly.value,o=new FormData;"fForm"===t?(graphResult.style.display="block",dscAvgSal.style.display="block",initiallyDummyGraph.style.display="none",document.getElementById("country-input-filter").value=n,document.getElementById("roles-input-filter").value=i,o.append("country",n),o.append("role",i),o.append("time",duration),selectedCountry.forEach(e=>e.innerText=n),yourRole.forEach(e=>e.innerHTML=i)):(o.append("country",coutryTwo.value),o.append("role",roleTwo.value),o.append("time",duration),selectedCountry.forEach(e=>e.innerText=coutryTwo.value),yourRole.forEach(e=>e.innerText=roleTwo.value)),fetch(scriptURL,{method:"POST",body:o,"Access-Control-Allow-Origin":"*"}).then(e=>e.json()).then(e=>{let t=e.data;if("data not found"===t[0].message){document.getElementById("data-not-found").style.display="flex";return}if(document.getElementById("data-not-found").style.display="none",minCtcMonth=t.map(e=>e.minCtcMonth>0?e.minCtcMonth:null),maxCtcMonth=t.map(e=>e.maxCtcMonth>0?e.maxCtcMonth:null),minCtcYear=t.map(e=>e.minCtcYear>0?e.minCtcYear:null),maxCtcYear=t.map(e=>e.maxCtcYear>0?e.maxCtcYear:null),"year"==duration){creatChart(minCtcYear,maxCtcYear),getMedian(maxCtcYear);let l=Number(medianValue.toFixed(2));l=l.toLocaleString(),document.getElementById("median-salary").innerText=`$${l}`}else{creatChart(minCtcMonth,maxCtcMonth),getMedian(maxCtcMonth);let r=Number(medianValue.toFixed(2));r=r.toLocaleString(),document.getElementById("median-salary").innerText=`$${r}`}}).catch(e=>console.log(e)).finally(()=>{loadingImg.style.display="none"})};let counter=!1;function creatChart(e,t){let l=t.reduce((e,t)=>Math.max(e,t),-1/0);var r=Chart.getChart("salaryChart");r&&r.destroy(),Chart.register(ChartDataLabels);var a=document.getElementById("salaryChart").getContext("2d");new Chart(a,{type:"bar",data:{labels:["1-4 years","4-7 years","7-10 years"],datasets:[{label:"Min Salary",backgroundColor:"rgba(28, 131, 252, 0.2)",borderColor:"rgba(28, 131, 252, 0.2)",borderWidth:1,data:e},{label:"Max Salary",backgroundColor:"rgba(28, 131, 252, 1)",borderColor:"rgba(28, 131, 252, 1)",borderWidth:1,data:t}]},options:{maintainAspectRatio:!1,responsive:!0,scales:{x:{stacked:!1,grid:{drawOnChartArea:!0,drawBorder:!1},border:{dash:[6,6]}},y:{beginAtZero:!1,display:!1,min:0,max:l,ticks:{stepSize:0+l/2}}},layout:{padding:{top:40}},plugins:{datalabels:{color:"#1a204a",anchor:"end",align:"top",formatter:e=>e?"$"+(Math.abs(e)>999?Math.sign(e)*(Math.abs(e)/1e3).toFixed(1)+"K":Math.sign(e)*Math.abs(e)):"",font:function(e){var t=Math.round(Math.round((e.chart.height+e.chart.width)/2)/32);return{size:t=t>12?16:t,family:"Inter, sans-serif"}}},legend:!1,tooltip:{callbacks:{label:function(e){return`$${e.formattedValue}`}}}},elements:{bar:{borderRadius:{topLeft:10,topRight:10}}}}})}document.addEventListener("DOMContentLoaded",function(){document.getElementById("fForm").addEventListener("submit",e=>{e.preventDefault();let t=localStorage.getItem("isDemoFormSubmitted");if(counter&&!t){onChange();return}searchHandler(e,"fForm"),counter=!0}),document.getElementById("get-final-data").addEventListener("submit",e=>{e.preventDefault();let t=localStorage.getItem("isDemoFormSubmitted");if(counter&&!t){onChange();return}searchHandler(e,"get-final-data")})});const priceSwitchTxtElements=document.querySelectorAll(".price-switch-txt"),priceSwitchBgElement=document.querySelector(".price-switch-bg");priceSwitchTxtElements.forEach(e=>{e.addEventListener("click",function(){if(this.classList.contains("month")){duration="month",document.getElementById("current-duration").innerText="monthly",creatChart(minCtcMonth,maxCtcMonth),getMedian(maxCtcMonth);let e=Number(medianValue.toFixed(2));e=e.toLocaleString(),document.getElementById("median-salary").innerText=`$${e}`,priceSwitchTxtElements.forEach(e=>{e.classList.remove("active")}),this.classList.add("active"),priceSwitchBgElement.classList.remove("active")}else{duration="year",document.getElementById("current-duration").innerText="annual",creatChart(minCtcYear,maxCtcYear),getMedian(maxCtcYear);let t=Number(medianValue.toFixed(2));t=t.toLocaleString(),document.getElementById("median-salary").innerText=`$${t}`,priceSwitchTxtElements.forEach(e=>{e.classList.remove("active")}),this.classList.add("active"),priceSwitchBgElement.classList.add("active")}})});const closePopup=document.getElementById("exitPopup"),popupClose=document.getElementById("cross-pattern"),popupForm=document.querySelector(".popup-form");function onChange(){let e=localStorage.getItem("isDemoFormSubmitted");counter&&!e&&closePopup.classList.add("visible")}function getMedian(e){medianValue=e.reduce((e,t)=>e+t)/e.length}function responsiveFonts(){window.outerWidth>999&&(Chart.defaults.font.size=16),window.outerWidth<999&&window.outerWidth>500&&(Chart.defaults.font.size=12),window.outerWidth<500&&(Chart.defaults.font.size=10)}popupClose&&popupClose.addEventListener("click",()=>{closePopup.classList.remove("visible")}),responsiveFonts();const inputs=document.querySelectorAll(".country-select");inputs.forEach(e=>{e.addEventListener("click",e=>{let t=document.querySelectorAll(".ul-list");t.forEach(e=>e.classList.remove("show")),e.target.value="",e.target.parentNode.querySelector("ul").classList.add("show");let l=e.target.parentElement.querySelector("ul").lastChild.className,r=e.target.parentNode.id,a={roles:roles,countries:countries,"roles-2":roles,"countries-2":countries};createList(a[r],r,l)})}),inputs.forEach(e=>{e.addEventListener("input",e=>{let t=document.querySelectorAll(".ul-list");t.forEach(e=>e.classList.remove("show")),e.target.parentNode.querySelector("ul").classList.add("show")})});const filterList=(e=[],t="",l,r)=>{let a=e.filter(e=>e.toLowerCase().includes(t?.toLowerCase()));a.length||(a=["Item not found"]),createList(a,l,r,!filterList.length)};inputs.forEach(e=>{e.addEventListener("input",t=>{let l={roles:roles,countries:countries,"roles-2":roles,"countries-2":countries},r=e.nextElementSibling.lastChild.className,a=e.parentNode.id;filterList(l[a],t.target.value,a,r)})}),document.body.addEventListener("click",e=>{let t=document.querySelector("ul.ul-list.show"),l=document.querySelectorAll(".country-select"),r=l.forEach(t=>t.contains(e.target)),a=document.querySelector(".ul-list");if(ulListContaines=a.contains(e.target),t){if(ulListContaines||r)return;t.classList.remove("show")}"country-select w-input"===e.target.className&&e.target.nextElementSibling.classList.add("show")}),document.addEventListener("keydown",e=>{if("ESC"===e.key){let t=document.querySelector("ul.ul-list.show");t.classList.remove("show")}}),inputs.forEach(e=>{e.addEventListener("keydown",e=>{let t=e.key,l=e.target.nextElementSibling,r=l.querySelector(".active");if("ArrowDown"===t){l.classList.add("show");let a=l.firstChild;if("Item not found"===a.innerText)return;if(r){let n=r.nextSibling;r.classList.remove("active"),n.classList.add("active")}else a.classList.add("active");r.scrollIntoView({block:"center"})}else if("ArrowUp"===t){let i=l.lastChild;if(r){let o=r.previousSibling;r.classList.remove("active"),o.classList.add("active")}else i.classList.add("active");r.scrollIntoView({block:"center"})}else"Enter"===t&&(e.preventDefault(),e.target.nextSibling.previousElementSibling.value=r.innerText,e.target.nextSibling.remove("show"))})});
