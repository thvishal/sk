const scriptURL="https://script.google.com/macros/s/AKfycbxYDZo3tZjFkNM5O96Fjda4dGy9ynHXl4GnQiUMQqXbRdGIf_8MWzznmS1uwTlT_9GFFA/exec",roleTwo=document.getElementById("roles-input-filter"),coutryTwo=document.getElementById("country-input-filter");roleTwo.value="Loading...",coutryTwo.value="Loading...",roleTwo.setAttribute("disabled",""),coutryTwo.setAttribute("disabled","");let allRoles=[];const createList=(e,t="",r="",a)=>{let l=document.getElementById(t),o=l.querySelector("ul"),n=o||document.createElement("ul");n.innerHTML="",e.forEach(e=>{let t=document.createElement("li");t.classList.add(r),t.innerText=e,t.addEventListener("click",e=>{if(e.target.parentNode.classList.remove("show"),"Item not found"===e.target.innerText){e.target.parentNode.classList.add("show");return}e.target.parentElement.previousElementSibling.value=e.target.innerText}),n.appendChild(t)}),n.classList.add("ul-list"),l.appendChild(n)};let countries=[],roles=[];const getData=()=>{fetch(scriptURL,{method:"GET","Access-Control-Allow-Origin":"*"}).then(e=>e.json()).then(e=>{countries=e.data.countries,createList(roles=e.data.roles,"roles-2","roles-list-item-2"),createList(countries,"countries-2","country-list-item-2"),roleTwo[0].innerText="Role",coutryTwo[0].innerText="Country"}).catch(e=>console.log(e)).finally(e=>{roleTwo.value="",coutryTwo.value="",roleTwo.removeAttribute("disabled"),coutryTwo.removeAttribute("disabled")})};getData();const graphResult=document.getElementById("graph-result"),loadingImg=document.getElementById("loading-img"),initiallyDummyGraph=document.querySelector(".graph-initial-screen");let minCtcMonth=[],maxCtcMonth=[],minCtcYear=[],maxCtcYear=[],medianValue=0;const durationChange=document.getElementById("duration");let duration="year";const yourRole=document.querySelectorAll(".your-role"),selectedCountry=document.querySelectorAll(".selected-country"),searchHandler=(e,t)=>{e.preventDefault();var r=document.querySelectorAll(".w-form-done"),a=document.querySelectorAll(".w-form-fail"),l=document.querySelectorAll("form");loadingImg.style.display="flex",l.forEach(function(e){e.classList.add("show")}),r.forEach(function(e){e.classList.add("hide")}),a.forEach(function(e){e.classList.add("hide")});let o=new FormData;graphResult.style.display="block",initiallyDummyGraph.style.display="none",o.append("country",coutryTwo.value),o.append("role",roleTwo.value),o.append("time",duration),selectedCountry.forEach(e=>e.innerText=coutryTwo.value),yourRole.forEach(e=>e.innerHTML=roleTwo.value),fetch(scriptURL,{method:"POST",body:o,"Access-Control-Allow-Origin":"*"}).then(e=>e.json()).then(e=>{let t=e.data;if("data not found"===t[0].message){document.getElementById("data-not-found").style.display="flex";return}document.getElementById("data-not-found").style.display="none",minCtcMonth=t.map(e=>e.minCtcMonth>0?e.minCtcMonth:null),maxCtcMonth=t.map(e=>e.maxCtcMonth>0?e.maxCtcMonth:null),minCtcYear=t.map(e=>e.minCtcYear>0?e.minCtcYear:null),maxCtcYear=t.map(e=>e.maxCtcYear>0?e.maxCtcYear:null),"year"==duration?creatChart(minCtcYear,maxCtcYear):creatChart(minCtcMonth,maxCtcMonth)}).catch(e=>console.log(e)).finally(()=>{loadingImg.style.display="none"})};let counter=!1;function creatChart(e,t){let r=t.reduce((e,t)=>Math.max(e,t),-1/0);var a=Chart.getChart("salaryChart");a&&a.destroy(),Chart.register(ChartDataLabels);var l=document.getElementById("salaryChart").getContext("2d");new Chart(l,{type:"bar",data:{labels:["1-4 years","4-7 years","7-10 years"],datasets:[{label:"Min Salary",backgroundColor:"rgba(28, 131, 252, 0.2)",borderColor:"rgba(28, 131, 252, 0.2)",borderWidth:1,data:e},{label:"Max Salary",backgroundColor:"rgba(28, 131, 252, 1)",borderColor:"rgba(28, 131, 252, 1)",borderWidth:1,data:t}]},options:{maintainAspectRatio:!1,responsive:!0,scales:{x:{stacked:!1,grid:{drawOnChartArea:!0,drawBorder:!1},border:{dash:[6,6]}},y:{beginAtZero:!1,display:!1,min:0,max:r,ticks:{stepSize:0+r/2}}},layout:{padding:{top:40}},plugins:{datalabels:{color:"#1a204a",anchor:"end",align:"top",formatter:e=>e?"$"+(Math.abs(e)>999?Math.sign(e)*(Math.abs(e)/1e3).toFixed(1)+"K":Math.sign(e)*Math.abs(e)):"",font:function(e){var t=Math.round(Math.round((e.chart.height+e.chart.width)/2)/32);return{size:t=t>12?16:t,family:"Inter, sans-serif"}}},legend:!1,tooltip:{callbacks:{label:function(e){return`$${e.formattedValue}`}}}},elements:{bar:{borderRadius:{topLeft:10,topRight:10}}}}})}document.addEventListener("DOMContentLoaded",function(){document.getElementById("get-final-data").addEventListener("submit",e=>{e.preventDefault();let t=localStorage.getItem("isFormSubmitted");if(counter&&!t){onChange();return}searchHandler(e,"get-final-data"),counter=!0})});const priceSwitchTxtElements=document.querySelectorAll(".price-switch-txt"),priceSwitchBgElement=document.querySelector(".price-switch-bg");priceSwitchTxtElements.forEach(e=>{e.addEventListener("click",function(){this.classList.contains("month")?(duration="month",creatChart(minCtcMonth,maxCtcMonth),priceSwitchTxtElements.forEach(e=>{e.classList.remove("active")}),this.classList.add("active"),priceSwitchBgElement.classList.remove("active")):(duration="year",creatChart(minCtcYear,maxCtcYear),priceSwitchTxtElements.forEach(e=>{e.classList.remove("active")}),this.classList.add("active"),priceSwitchBgElement.classList.add("active"))})});const closePopup=document.getElementById("exitPopup"),popupClose=document.getElementById("cross-pattern"),popupForm=document.querySelector(".popup-form");function onChange(){let e=localStorage.getItem("isFormSubmitted");counter&&!e&&closePopup.classList.add("visible")}function responsiveFonts(){window.outerWidth>999&&(Chart.defaults.font.size=16),window.outerWidth<999&&window.outerWidth>500&&(Chart.defaults.font.size=12),window.outerWidth<500&&(Chart.defaults.font.size=10)}popupClose&&popupClose.addEventListener("click",()=>{closePopup.classList.remove("visible")}),responsiveFonts();const inputs=document.querySelectorAll(".country-select");inputs.forEach(e=>{e.addEventListener("click",e=>{let t=document.querySelectorAll(".ul-list");t.forEach(e=>e.classList.remove("show")),e.target.value="",e.target.parentNode.querySelector("ul").classList.add("show");let r=e.target.parentElement.querySelector("ul").lastChild.className,a=e.target.parentNode.id,l={roles:roles,countries:countries,"roles-2":roles,"countries-2":countries};createList(l[a],a,r)})}),inputs.forEach(e=>{e.addEventListener("input",e=>{let t=document.querySelectorAll(".ul-list");t.forEach(e=>e.classList.remove("show")),e.target.parentNode.querySelector("ul").classList.add("show")})});const filterList=(e=[],t="",r,a)=>{let l=e.filter(e=>e.toLowerCase().includes(t?.toLowerCase()));l.length||(l=["Item not found"]),createList(l,r,a,!filterList.length)};inputs.forEach(e=>{e.addEventListener("input",t=>{let r={roles:roles,countries:countries,"roles-2":roles,"countries-2":countries},a=e.nextElementSibling.lastChild.className,l=e.parentNode.id;filterList(r[l],t.target.value,l,a)})}),document.body.addEventListener("click",e=>{let t=document.querySelector("ul.ul-list.show"),r=document.querySelectorAll(".country-select"),a=r.forEach(t=>t.contains(e.target)),l=document.querySelector(".ul-list");if(ulListContaines=l.contains(e.target),t){if(ulListContaines||a)return;t.classList.remove("show")}"country-select w-input"===e.target.className&&e.target.nextElementSibling.classList.add("show")}),document.addEventListener("keydown",e=>{if("ESC"===e.key){let t=document.querySelector("ul.ul-list.show");t.classList.remove("show")}}),inputs.forEach(e=>{e.addEventListener("keydown",e=>{let t=e.key,r=e.target.nextElementSibling,a=r.querySelector(".active");if("ArrowDown"===t){r.classList.add("show");let l=r.firstChild;if("Item not found"===l.innerText)return;if(a){let o=a.nextSibling;a.classList.remove("active"),o.classList.add("active")}else l.classList.add("active");a.scrollIntoView({block:"center"})}else if("ArrowUp"===t){let n=r.lastChild;if(a){let s=a.previousSibling;a.classList.remove("active"),s.classList.add("active")}else n.classList.add("active");a.scrollIntoView({block:"center"})}else"Enter"===t&&(e.preventDefault(),e.target.nextSibling.previousElementSibling.value=a.innerText,e.target.nextSibling.remove("show"))})});
